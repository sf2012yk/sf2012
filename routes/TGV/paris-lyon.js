// Paris Lyon module

// é‰„é“ãƒ«ãƒ¼ãƒˆã€€ãƒ‘ãƒªâ‡”ãƒªãƒ¨ãƒ³//
const ParisLyon_LY = [48.84423772852879, 2.3753086448157688];
const Bercy_LY = [48.839661574635876, 2.3851960503223633];
const FR_E15_LY = [48.82845037706814, 2.397748788550312648];
const FR_A4_LY = [48.8174039145587, 2.4151876965792733];
const Alfortville_LY = [48.80201123142838, 2.4265004218618285];
const FR_D148_LY = [48.79999664279838, 2.427678457053146];
const LeVert_LY = [48.788825462639345, 2.4319818002470206];
const FR_A86_LY = [48.776540617018554, 2.4360957817398483];
const FR_D86_LY = [48.77371242705531, 2.436911173289546];
const FR_N6_LY = [48.76992240258364, 2.440387316118305];
const FR_N406_LY = [48.75994272861413, 2.4680369689538635];
const FR_D110_LY = [48.75202077713751, 2.4706548049258505];
const FR_D229_LY = [48.74894699077105, 2.472232905521667];
const FR_D136_LY = [48.74119311179284, 2.4784985458012105];
const FR_D204_LY = [48.73440041004084, 2.4966946517823745];
const FR_D260_LY = [48.73281173147238, 2.5130217366275165];
const FR_D253_LY = [48.72643485434774, 2.5311474928180524];
const FR_D252_Servon_LY = [48.71401509402101, 2.5614319325004704];
const FR_N19_LY = [48.7052221110734, 2.592459726442182];
const FR_D216_Brie_LY = [48.704734833397, 2.6272207902150515];
const FR_D35_Brie_LY = [48.70334499146903, 2.6695248802543823];
const FR_D471_CDGJC_LY = [48.70035720295291, 2.694273280073363]; //CDGç©ºæ¸¯åˆ†å²
const FR_D96_CDGJC_LY = [48.680356488445724, 2.7259448041472787]; //CDGç©ºæ¸¯åˆ†å²
const FR_D319_LY = [48.66060592329269, 2.732777564398302];
const FR_D619_LY = [48.634537702619525, 2.7315974571600217];
const FR_D130_LY = [48.62442916734996, 2.7238034894568033];
const FR_D1036_LY = [48.590603959376026, 2.7243446593247898];
const StGermainJC_LY = [48.58110743777336, 2.7352929155770704]; //é«˜é€Ÿã‚¤ãƒ³ã‚¿ãƒ¼åˆ†å²
const FR_D215_LY = [48.56918768473357, 2.753233616802544];
const FR_D408_LY = [48.546343733094396, 2.781635168465992];
const FR_D213_LY = [48.50556602903552, 2.831454213676646];
const FR_D227_LY = [48.47578456752178, 2.8667947428630725];
const FR_D107_Valence_LY = [48.44926083044691, 2.8990176667299994];
const FR_D210_LY = [48.42026913890573, 2.934768965364895];
const FR_D403_LY = [48.39823553019191, 2.976129521480347];
const FR_D411_LY = [48.38189160303875, 3.0011680546290114];
const FR_D29_LY = [48.3727012044652, 3.0525579807681793];
const FR_D75_2_LY = [48.37128577631171, 3.095341623271209];
const FR_D195_LY = [48.36550196694265, 3.146548265819172];
const FR_D70_3_LY = [48.36067147753659, 3.1585229889623907];
const FR_D976_LY = [48.324675644672546, 3.2262855505700556];
const FR_D25_LY = [48.28682492195246, 3.2673895771591583];
const FR_A19_LY = [48.259270961242315, 3.2865491344459357];
const FR_D939_LY = [48.23406534799822, 3.303570233278068];
const FR_D46_Sense_LY = [48.206704595978245, 3.3259454894156533]; //Sense
const FR_D225_LY = [48.19416072390077, 3.331838566740761];
const FR_D660_LY = [48.17726116463888, 3.359009636227511];
const FR_D146_LY = [48.164497607455715, 3.3841386813657572];
const FR_D27_2_LY = [48.14311354307318, 3.4090697841362854];
const FR_D20_LY = [48.1101753718464, 3.4596807681141812];
const FR_D201_LY = [48.08940050314071, 3.5012078977056915];
const FR_D77_LY = [48.08535841392647, 3.5135246014919423];
const FR_D47_LY = [48.06826399370613, 3.5618198014376956];
const FR_D69_LY = [48.05466884906179, 3.5764110184999494];
const FR_D84_2_LY = [48.0318901293951, 3.605605243183893];
const FR_D943_LY = [48.00024416814994, 3.6512711133987854];
const VergignyJC_LY = [47.98101081573711, 3.6793073085085672]; //TGVã‚¸ãƒ£ãƒ³ã‚¯ã‚·ãƒ§ãƒ³
const FR_D43_LY = [47.96893391486615, 3.704967506103965];
const FR_N77_LY = [47.95834547488497, 3.7274181163903326];
const FR_D334_LY = [47.951146967868944, 3.7439011662686017];
const FR_D34_LY = [47.94265066689042, 3.7678789733468463];
const FR_D124_LY = [47.939862047561135, 3.7774061798748977];
const FR_D8_LY = [47.916643870887526, 3.832450238841469];
const FR_D216_LY = [47.91221428127292, 3.838758794472008];
const VÃ©zannes_LY = [47.87361598211996, 3.872624649694566];
const FR_D51_LY = [47.86065226387725, 3.890573806220577];
const FR_D226_LY = [47.8569665712519, 3.900744742729271];
const FR_D35_LY = [47.849162404403145, 3.9250777429910504];
const FR_D965_LY = [47.838936975697685, 3.9490313625865547];
const FR_D139_LY = [47.835048086275, 3.956284055701042];
const FR_D944_LY = [47.830150551755736, 3.9637942410272085];
const FR_D117_LY = [47.809593721894025, 3.982598577905928];
const FR_D200_LY = [47.770182022893216, 4.026024064088837];
const FR_D109_LY = [47.73384794788952, 4.048230394101835];
const FR_D956_LY = [47.696669907380794, 4.070761967064577];
const DijonJC_LY = [47.68069081134381, 4.080632487722975]; //ãƒ‡ã‚£ã‚¸ãƒ§ãƒ³æ–¹é¢ã¸åˆ†å²
const FR_D68_LY = [47.63521445803463, 4.108522150184347];
const FR_D101_LY = [47.62298560169355, 4.11525794566833];
const FR_D957_LY = [47.567857259812, 4.130408123236776];
const FR_D168_LY = [47.55873206941985, 4.129004097361848];
const FR_D144_LY = [47.528052881261246, 4.134239819814062];
const FR_D954_LY = [47.501221557465456, 4.142085460528361];
const FR_A6_LY = [47.48632984419622, 4.15575041968694];
const FR_D4_LY = [47.47803409653872, 4.16452802796698];
const FR_D9_LY = [47.44982597171408, 4.193437834639063];
const FR_D15_LY = [47.418635015591406, 4.216300630166065];
const FR_D70_LY = [47.40141399315774, 4.224441275341837];
const FR_D108_LY = [47.35477328748166, 4.2425724070642135];
const BaseSNCF_LY = [47.34763250369402, 4.245858396704591];
const FR_D980_LY = [47.31910404637165, 4.265919953099258];
const FR_D26_LY = [47.3071778147734, 4.269976475383961];
const FR_D117C_LY = [47.29770412679883, 4.271417771898193];
const FR_D977BIS_LY = [47.25663268941202, 4.289891362623484];
const FR_D906_LY = [47.24273240286631, 4.295843105363969];
const FR_D17B_LY = [47.21608489728801, 4.306699045349438];
const FR_D106_LY = [47.202394075390664, 4.313031506294082];
const FR_D117_2_LY = [47.181810272167446, 4.326245389484144];
const FR_D15E_LY = [47.16477502122623, 4.335980885396083];
const FR_D17_LY = [47.14972643521876, 4.341606531060223];
const Marcheseuil_D11_LY = [47.141744423738224, 4.344549865658522];
const FR_D11A_LY = [47.125782145236066, 4.352725238726501];
const FR_D981_LY = [47.07970333400333, 4.364084141702858];
const FR_D26_2_LY = [47.04810382749761, 4.358204011280387];
const FR_D151_LY = [47.02598092768903, 4.376388246876897];
const FR_D107_LY = [47.00918779294288, 4.433027689911865];
const FR_D326_LY = [46.99870786520141, 4.453048348593735];
const FR_D973_LY = [46.97956313842599, 4.476777123912725];
const FR_D298_LY = [46.957063918104154, 4.48613187961939];
const FR_D43_2_LY = [46.947485032096054, 4.488024361167361];
const FR_D343_LY = [46.92562761861002, 4.49163305472511];
const FR_D145_LY = [46.912171456752375, 4.490409963106479];
const FR_D978_LY = [46.902546742388964, 4.489488203326896];
const FR_D131_LY = [46.887403807984214, 4.488283851894295];
const FR_D431_LY = [46.84004688227078, 4.493271395315387];
const FR_D1_LY = [46.8203167166869, 4.493353705300677];
const FR_D984_LY = [46.81344629547252, 4.494098936329058];
const LeCreusot_LY = [46.76531181474312, 4.499867540685522]; //LeCreusoté§…
const FR_D974_LY = [46.75543822467896, 4.502441301619431];
const FR_M80_LY = [46.74935558768644, 4.505074406253593];
const FR_D18_LY = [46.74358634685127, 4.50773386981272];
const FR_D977_LY = [46.726080590396606, 4.5189503005110145];
const FR_D28_LY = [46.71888162375206, 4.52409756619513];
const FR_D28_3_LY = [46.69852776752611, 4.545929096899003];
const FR_D236_LY = [46.6814974126622, 4.568361733683169];
const FR_D28_4_LY = [46.67108460099472, 4.575548951421227];
const FR_D983_LY = [46.65638579077618, 4.580677954231877];
const FR_D236_2_LY = [46.64506601114184, 4.584108013303402];
const FR_D60_LY = [46.61107468158997, 4.604651936586067];
const FR_D84_LY = [46.56943400590594, 4.62169896064738];
const FR_D127_LY = [46.54390729114605, 4.639796998906703];
const Cortevaix_LY = [46.53819266502503, 4.642475526081343];
const FR_D117_3_LY = [46.500209337414944, 4.656371551706804];
const FR_D981_2_LY = [46.46486314118556, 4.669578571930919];
const FR_D15_Cluny_LY = [46.43018961694845, 4.672305698828604];
const FR_D980_Cluny_LY = [46.41135738465925, 4.659191605306897];
const FR_N79_LY = [46.38982323352867, 4.661536913048362];
const FR_E62_LY = [46.37626357070466, 4.67133882792366];
const Sologny_LY = [46.36274283714873, 4.68737701468554];
const FR_D212_LY = [46.35066960951795, 4.706825299746999];
const FR_D85_LY = [46.34157347731081, 4.719128136191205];
const FR_D45_LY = [46.32883450147052, 4.732875919519329];
const FR_D209_LY = [46.31942098968365, 4.7413895487775175];
const FR_D89_LY = [46.30917878243009, 4.754986520788524];
const FR_D54_LY = [46.299410083128684, 4.766980859250442];
const MaconLoche_LY = [46.28272632422479, 4.778354089842496]; //MÃ¢conLochÃ©é§…
const FR_E15_Macon_LY = [46.27416369956979, 4.7876936396606204];
const FR_D906_Macon_LY = [46.26899158963089, 4.796365919649297];
const SaoneRiver_LY = [46.263061782003625, 4.813081060814195];
const MaconTGVJC_LY = [46.25943160251653, 4.826014040479367]; //ã‚¸ãƒ¥ãƒãƒ¼ãƒ–è¡Œãåˆ†å²
const Macon_D51_LY = [46.25480266601795, 4.8360991463908105];
const FR_D51B_LY = [46.24812562714204, 4.845583437500776];
const FR_D933_2_LY = [46.23770847338955, 4.853899573934292];
const FR_D96A_LY = [46.21514462636051, 4.857375716812284];
const FR_D66A_LY = [46.186117680443274, 4.85408691064421];
const FR_D64_LY = [46.17178750258107, 4.848959178511448];
const FR_D7_LY = [46.16358449917292, 4.845912189061357];
const FR_D75D_LY = [46.13655868217283, 4.84231314411568];
const FR_D100_LY = [46.1154418532963, 4.842390706073014];
const FR_D17_Chaneins_LY = [46.09726406555281, 4.8461717951862076];
const FR_D75_LY = [46.09001692179629, 4.847839438191781];
const FR_D27_LY = [46.07062910280569, 4.8492275524123425];
const FR_D75B_LY = [46.05925885015758, 4.849167567280539];
const FR_D936_LY = [46.033207974818964, 4.8506956815449085];
const FR_D70_2_LY = [46.02173624617346, 4.853013110129433];
const FR_D904_LY = [46.00068769841577, 4.858697585869845];
const FR_D88_LY = [45.96877687665396, 4.862767320697221];
const FR_D6_LY = [45.95245838169289, 4.865342241340893];
const FR_D4_Pouilleux_LY = [45.93799837012788, 4.867605426603351];
const FR_D66E_LY = [45.92053695429386, 4.871692821500412];
const FR_A46_LY = [45.90184296706831, 4.874685317807498];
const LyonCityJC_LY = [45.882760703301294, 4.880043976295247]; //ãƒªãƒ¨ãƒ³å¸‚å†…è¡Œãåˆ†å²
const FR_D1_Lyon = [45.870980896573386, 4.883157245386085];
const FR_D85_2 = [45.85899890131465, 4.8862116303695835];
const VanciaLn = [45.835815123778985, 4.89123764156639];
const Sathonay = [45.82005402913132, 4.875467629611808]; //Sathonayé§…
const LyonTn_1 = [45.81356298762567, 4.86957181149089];ã€€//ãƒªãƒ¨ãƒ³ãƒˆãƒ³ãƒãƒ«
const LyonTn_3 = [45.808876231121246, 4.881955300435311];ã€€//ãƒªãƒ¨ãƒ³ãƒˆãƒ³ãƒãƒ«
const FR_D484 = [45.804928873455324, 4.884275112104691];
const FR_D483 = [45.79363427502386, 4.871700916284386];
const FR_D48 = [45.789624516008274, 4.860542926720166];
const Botanique = [45.77281359845206, 4.858495068557836];
const PartDieu = [45.7603030076784, 4.860375801911088]; //ãƒªãƒ¨ãƒ³ãƒ»ãƒ‘ãƒ¼ãƒ«ãƒ‡ãƒ¥ãƒ¼é§…

// çµŒç”±åœ°ã‚’å«ã‚€ãƒ«ãƒ¼ãƒˆ
const LGV_PRLY = L.polyline([
ParisLyon_LY,Bercy_LY,FR_E15_LY,FR_A4_LY,Alfortville_LY,FR_D148_LY,
LeVert_LY,FR_A86_LY,FR_D86_LY,FR_N6_LY,FR_N406_LY,FR_D110_LY,FR_D229_LY,FR_D136_LY,FR_D204_LY,FR_D260_LY,FR_D253_LY,
FR_D252_Servon_LY,FR_N19_LY,FR_D216_Brie_LY,FR_D35_Brie_LY,
FR_D471_CDGJC_LY,FR_D96_CDGJC_LY,FR_D319_LY,FR_D619_LY,FR_D130_LY,FR_D1036_LY,
StGermainJC_LY,FR_D215_LY,FR_D408_LY,FR_D213_LY,FR_D227_LY,
FR_D107_Valence_LY,FR_D210_LY,FR_D403_LY,FR_D411_LY,FR_D29_LY,FR_D75_2_LY,FR_D195_LY,FR_D70_3_LY,FR_D976_LY,FR_D25_LY,FR_A19_LY,FR_D939_LY,
FR_D46_Sense_LY,FR_D225_LY,FR_D660_LY,FR_D146_LY,FR_D27_2_LY,FR_D20_LY,FR_D201_LY,FR_D77_LY,FR_D47_LY,FR_D69_LY,FR_D84_2_LY,FR_D943_LY,
VergignyJC_LY,FR_D43_LY,FR_N77_LY,FR_D334_LY,FR_D34_LY,FR_D124_LY,FR_D8_LY,FR_D216_LY,
VÃ©zannes_LY,FR_D51_LY,FR_D226_LY,FR_D35_LY,FR_D965_LY,FR_D139_LY,FR_D944_LY,FR_D117_LY,FR_D200_LY,FR_D109_LY,FR_D956_LY,
DijonJC_LY,FR_D68_LY,FR_D101_LY,FR_D957_LY,FR_D168_LY,FR_D144_LY,FR_D954_LY,FR_A6_LY,FR_D4_LY,FR_D9_LY,FR_D15_LY,FR_D70_LY,FR_D108_LY,
BaseSNCF_LY,FR_D980_LY,FR_D26_LY,FR_D117C_LY,FR_D977BIS_LY,FR_D906_LY,FR_D17B_LY,FR_D106_LY,FR_D117_2_LY,FR_D15E_LY,FR_D17_LY,
Marcheseuil_D11_LY,FR_D11A_LY,FR_D981_LY,FR_D26_2_LY,FR_D151_LY,FR_D107_LY,FR_D326_LY,FR_D973_LY,FR_D298_LY,FR_D43_2_LY,FR_D343_LY,FR_D145_LY,FR_D978_LY,FR_D131_LY,FR_D431_LY,FR_D1_LY,FR_D984_LY,
LeCreusot_LY,FR_D974_LY,FR_M80_LY,FR_D18_LY,FR_D977_LY,FR_D28_LY,FR_D28_3_LY,FR_D236_LY,FR_D28_4_LY,FR_D983_LY,FR_D236_2_LY,FR_D60_LY,FR_D84_LY,FR_D127_LY,
Cortevaix_LY,FR_D117_3_LY,FR_D981_2_LY,FR_D15_Cluny_LY,FR_D980_Cluny_LY,FR_N79_LY,FR_E62_LY,
Sologny_LY,FR_D212_LY,FR_D85_LY,FR_D45_LY,FR_D209_LY,FR_D89_LY,FR_D54_LY,MaconLoche_LY,FR_E15_Macon_LY,FR_D906_Macon_LY,SaoneRiver_LY,MaconTGVJC_LY,
Macon_D51_LY,FR_D51B_LY,FR_D933_2_LY,FR_D96A_LY,FR_D96A_LY,FR_D66A_LY,FR_D64_LY,FR_D7_LY,FR_D75D_LY,FR_D100_LY,
FR_D17_Chaneins_LY,FR_D75_LY,FR_D27_LY,FR_D75B_LY,FR_D936_LY,FR_D70_2_LY,FR_D904_LY,FR_D88_LY,FR_D6_LY,FR_D4_Pouilleux_LY,FR_D66E_LY,FR_A46_LY,LyonCityJC_LY,
FR_D1_Lyon,FR_D85_2,VanciaLn,Sathonay,LyonTn_1,LyonTn_3,FR_D484,FR_D483,FR_D48,Botanique,
PartDieu], { color: '#000000', smoothFactor: '1.0'}).addTo(map);


// ãƒ‘ãƒª â†’ ãƒªãƒ¨ãƒ³é§…ã¸æ»‘ã‚‰ã‹ã«ç§»å‹•ã™ã‚‹é–¢æ•°
//ã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²ã‚’ç„¡åˆ¶é™åˆ¶é™
map.on('popupopen', function (e) {
  const LyonBtn = document.getElementById('goToLyonCard');
  if (LyonBtn) {
    const newBtn = LyonBtn.cloneNode(true);
    LyonBtn.parentNode.replaceChild(newBtn, LyonBtn);

    newBtn.addEventListener('click', () => {
      if (!animationRunning) {
        goToLyon();
      }
    });
  }
  })

function goToLyon() {
  if (animationRunning) return; // â† ã™ã§ã«å‹•ã„ã¦ã„ãŸã‚‰ä½•ã‚‚ã—ãªã„
  animationRunning = true;

  markerParisLyon.closePopup(); // â† ç§»å‹•å‰ã«ParisLyoné§…ã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‰ã˜ã‚‹

  // ðŸš„ ã‚¢ã‚¤ã‚³ãƒ³ä»˜ããƒžãƒ¼ã‚«ãƒ¼ã‚’è¡¨ç¤ºï¼ˆåˆæœŸä½ç½®ï¼‰
  const trainIcon = L.icon({
    iconUrl: "image/icon/train_test.png",// ã‚¢ã‚¤ã‚³ãƒ³ç”»åƒã®URL
    iconRetinaUrl:"image/icon/train_test@2x.png",
    iconSize: [40, 40],
    iconAnchor: [25, 25],
    className: "icon-train"
  });

  const trainMarker = L.marker(ParisLyon_LY, { icon: trainIcon }).addTo(map);

  const fullPath = interpolatePolyline(LGV_PRLY , 50);// â† æ•°å­—ãŒå°‘ãªã„ã»ã©ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚¢ãƒƒãƒ—

  const lyonIndex = fullPath.findIndex(p => 
    Math.abs(p[0] - PartDieu[0]) < 0.0001 && 
    Math.abs(p[1] - PartDieu[1]) < 0.0001
  );

  const pathToLyon = fullPath.slice(0, lyonIndex + 1);
  const totalFrames = pathToLyon.length;
  let frame = 0;

  function animate() {
   
   const index = frame;

    if (index < pathToLyon.length) {
      trainMarker.setLatLng(pathToLyon[index]); // â† ãƒžãƒ¼ã‚«ãƒ¼ã‚’ç§»å‹•
      map.panTo(pathToLyon[index], { animate: true, duration: 0.25 });
      frame++;
      setTimeout(animate, 5); // â† é€Ÿåº¦èª¿æ•´ï¼ˆæ•°å­—ãŒå°‘ãªã„ã»ã©ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚¢ãƒƒãƒ—ï¼‰
    } else {
      setTimeout(() => {
        markerPartDieu.openPopup();
        map.removeLayer(trainMarker); // ã‚¢ã‚¤ã‚³ãƒ³ã‚’å‰Šé™¤
        animationRunning = false;
      }, 100);

    }
  }
  animate();
}

// ãƒªãƒ¨ãƒ³ã€€â†’ã€€ãƒ‘ãƒªé§…ã¸æ»‘ã‚‰ã‹ã«ç§»å‹•ã™ã‚‹é–¢æ•°
//ã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²ã‚’ç„¡åˆ¶é™åˆ¶é™
map.on('popupopen', function (e) {
  const ParisBtn = document.getElementById('goToParisCard');
  if (ParisBtn) {
    const newBtn = ParisBtn.cloneNode(true);
    ParisBtn.parentNode.replaceChild(newBtn, ParisBtn);

    newBtn.addEventListener('click', () => {
      if (!animationRunning) {
        goToParis();
      }
    });
  }
  })

function goToParis() {
  if (animationRunning) return; // â† ã™ã§ã«å‹•ã„ã¦ã„ãŸã‚‰ä½•ã‚‚ã—ãªã„
  animationRunning = true;

  markerPartDieu.closePopup(); // â† ç§»å‹•å‰ã«PartDieué§…ã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‰ã˜ã‚‹

  // ðŸš„ ã‚¢ã‚¤ã‚³ãƒ³ä»˜ããƒžãƒ¼ã‚«ãƒ¼ã‚’è¡¨ç¤ºï¼ˆåˆæœŸä½ç½®ï¼‰
  const trainIcon = L.icon({
    iconUrl: "image/icon/train_test.png",// ã‚¢ã‚¤ã‚³ãƒ³ç”»åƒã®URL
    iconRetinaUrl:"image/icon/train_test@2x.png",
    iconSize: [40, 40],
    iconAnchor: [25, 25],
    className: "icon-train"
  });

  const trainMarker = L.marker(PartDieu, { icon: trainIcon }).addTo(map);

  const fullPath = [...interpolatePolyline(LGV_PRLY, 50)].reverse();// â† æ•°å­—ãŒå°‘ãªã„ã»ã©ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚¢ãƒƒãƒ—

  const parisIndex = fullPath.findIndex(p => 
    Math.abs(p[0] - ParisLyon_LY[0]) < 0.0001 && 
    Math.abs(p[1] - ParisLyon_LY[1]) < 0.0001
  );

  const pathToParis = fullPath.slice(0, parisIndex + 1);
  
// æœ€åˆã«ã‚¸ãƒ£ãƒ³ãƒ—ã‚’é˜²ã
  map.panTo(pathToParis[0], { animate: false });


  let frame = 0;

  function animate() {
   
   const index = frame;

    if (index < pathToParis.length) {
      trainMarker.setLatLng(pathToParis[index]); // â† ãƒžãƒ¼ã‚«ãƒ¼ã‚’ç§»å‹•
      map.panTo(pathToParis[index], { animate: true, duration: 0.25 });
      frame++;
      setTimeout(animate, 5); // â† é€Ÿåº¦èª¿æ•´ï¼ˆæ•°å­—ãŒå°‘ãªã„ã»ã©ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚¢ãƒƒãƒ—ï¼‰
    } else {
      setTimeout(() => {
        markerParisLyon.openPopup();
        map.removeLayer(trainMarker); // ã‚¢ã‚¤ã‚³ãƒ³ã‚’å‰Šé™¤
        animationRunning = false;
      }, 100);

    }
  }
  animate();
}
